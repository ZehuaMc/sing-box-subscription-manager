<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>ğŸš€ Sing-Box é…ç½®ç®¡ç†å¹³å° ğŸš€</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <!-- CodeMirror CSS and JS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.61.0/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.61.0/theme/material-darker.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.61.0/theme/eclipse.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.61.0/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.61.0/mode/javascript/javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.61.0/addon/runmode/runmode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.61.0/addon/edit/matchbrackets.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.61.0/addon/edit/closebrackets.min.js"></script>
  <!-- Animation library -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  <style>
    :root {
      /* Light mode colors */
      --primary: #0070f3;
      --primary-hover: #0050c0;
      --secondary: #7928ca;
      --accent: #ff4081;
      --background: #f6f8fa;
      --foreground: #111;
      --card: #fff;
      --card-hover: #f9fafb;
      --border: #eaeaea;
      --border-hover: #ddd;
      --success: #0070f3;
      --error: #ff4d4f;
      --warning: #faad14;
      --info: #1890ff;
      --muted: #737373;
      --surface: #f5f5f7;
      --surface-hover: #f0f0f0;
      --header-bg: linear-gradient(135deg, #0070f3, #8e24aa);
      --tab-active: rgba(0, 112, 243, 0.1);
      --toast-bg: rgba(0, 0, 0, 0.8);
      --toast-text: #fff;
      --link: #0070f3;

      /* Shadows */
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 8px 30px rgba(0, 0, 0, 0.12);
      --shadow-focus: 0 0 0 2px rgba(0, 112, 243, 0.2);
      
      /* Sizing and spacing */
      --radius-sm: 0.375rem;
      --radius-md: 0.5rem;
      --radius-lg: 0.75rem;
      --radius-xl: 1rem;
      --radius-full: 9999px;
      
      --space-xs: 0.25rem;
      --space-sm: 0.5rem;
      --space-md: 1rem;
      --space-lg: 1.5rem;
      --space-xl: 2rem;
      --space-2xl: 2.5rem;
      
      /* Typography */
      --font-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      --font-mono: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      
      /* Animation */
      --transition-fast: 0.15s ease;
      --transition-normal: 0.3s ease;
      --transition-slow: 0.5s ease;
      
      --header-height: 60px;
      --footer-height: 50px;
      --content-max-width: 1200px;
    }

    .dark-mode {
      /* Dark mode variables */
      --primary: #3291ff;
      --primary-hover: #006ae6;
      --secondary: #8a63d2;
      --accent: #ff4081;
      --background: #141414;
      --foreground: #fff;
      --card: #1f1f1f;
      --card-hover: #252525;
      --border: #333;
      --border-hover: #444;
      --muted: #888;
      --surface: #121212;
      --surface-hover: #1e1e1e;
      --header-bg: linear-gradient(135deg, #0062d6, #7c2ead);
      --tab-active: rgba(50, 145, 255, 0.15);
      --toast-bg: rgba(255, 255, 255, 0.9);
      --toast-text: #000;
      --link: #3291ff;
      
      /* CodeMirror specific */
      --cm-background: #1e1e1e;
      --cm-foreground: #e0e0e0;
      --cm-border: #333;
    }

    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      font-family: var(--font-sans);
      height: 100%;
      line-height: 1.6;
      overflow-x: hidden;
    }

    body {
      background-color: var(--background);
      color: var(--foreground);
      transition: background-color var(--transition-normal), color var(--transition-normal);
      font-size: 16px;
      width: 100%;
      max-width: 100%;
    }

    /* Typography */
    h1, h2, h3, h4, h5, h6 {
      font-weight: 600;
      line-height: 1.25;
      margin-bottom: var(--space-md);
      color: var(--foreground);
    }

    h1 {
      font-size: 2rem;
    }

    h2 {
      font-size: 1.5rem;
    }

    h3 {
      font-size: 1.25rem;
    }

    p {
      margin-bottom: var(--space-md);
    }

    a {
      color: var(--link);
      text-decoration: none;
      transition: color var(--transition-fast);
    }

    a:hover {
      text-decoration: underline;
    }

    /* Layout */
    .container {
      width: 100%;
      max-width: var(--content-max-width);
      margin: 0 auto;
      padding: 0 var(--space-lg);
      overflow-x: hidden;
    }

    .header {
      position: relative;
      background: var(--header-bg);
      color: white;
      padding: var(--space-lg) 0;
      box-shadow: var(--shadow-md);
      transition: background var(--transition-normal);
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      right: -50%;
      bottom: -50%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
      animation: pulse 20s infinite;
      z-index: 0;
    }

    @keyframes pulse {
      0% { transform: scale(1); opacity: 0; }
      50% { transform: scale(1.1); opacity: 0.2; }
      100% { transform: scale(1); opacity: 0; }
    }

    .header-content {
      position: relative;
      z-index: 10;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .header h1 {
      margin: 0;
      color: white;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      animation: fadeInDown 0.8s ease-out;
    }

    .main-content {
      padding: var(--space-xl) 0;
      min-height: calc(100vh - var(--header-height) - var(--footer-height));
      overflow-x: hidden;
    }

    /* Cards */
    .card {
      background-color: var(--card);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      margin-bottom: var(--space-xl);
      overflow: hidden;
      transition: all var(--transition-normal);
      border: 1px solid var(--border);
    }

    .card:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }

    .card-header {
      padding: var(--space-lg);
      border-bottom: 1px solid var(--border);
    }

    .card-header h2, .card-header h3 {
      margin-bottom: 0;
    }

    .card-body {
      padding: var(--space-lg);
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.5rem 1.25rem;
      background-color: var(--primary);
      color: white;
      border-radius: var(--radius-md);
      font-weight: 500;
      cursor: pointer;
      transition: all var(--transition-fast);
      border: none;
      font-size: 0.95rem;
      height: 2.5rem;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
      position: relative;
      overflow: hidden;
    }

    .btn::after {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: -100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: 0.5s;
    }

    .btn:hover {
      background-color: var(--primary-hover);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      transform: translateY(-1px);
    }

    .btn:hover::after {
      left: 100%;
    }

    .btn:active {
      transform: translateY(1px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .btn-outline {
      background-color: transparent;
      color: var(--primary);
      border: 1px solid var(--primary);
    }

    .btn-outline:hover {
      background-color: var(--primary);
      color: white;
    }

    .btn-danger {
      background-color: var(--error);
    }

    .btn-danger:hover {
      background-color: #d9363e;
    }

    .btn-sm {
      height: 2rem;
      padding: 0 0.75rem;
      font-size: 0.85rem;
    }

    .btn-lg {
      height: 3rem;
      padding: 0 1.5rem;
      font-size: 1.1rem;
    }

    .btn-icon {
      width: 2.5rem;
      padding: 0;
    }

    .btn-group {
      display: flex;
      gap: var(--space-sm);
    }

    /* Advanced buttons for endpoint actions */
    .action-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.4rem 0.8rem;
      font-size: 0.85rem;
      font-weight: 500;
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all var(--transition-fast);
      border: none;
      height: 2.2rem;
      box-shadow: var(--shadow-sm);
      position: relative;
      overflow: hidden;
    }
    
    .action-btn.edit {
      background-color: var(--primary);
      color: white;
    }
    
    .action-btn.edit:hover {
      background-color: var(--primary-hover);
      box-shadow: var(--shadow-md);
    }
    
    .action-btn.delete {
      background-color: var(--error);
      color: white;
    }
    
    .action-btn.delete:hover {
      background-color: #d9363e;
      box-shadow: var(--shadow-md);
    }

    /* Icons */
    .icon {
      width: 1.25rem;
      height: 1.25rem;
      stroke-width: 2;
      margin-right: 0.5rem;
    }

    .icon-only {
      margin-right: 0;
    }

    /* Forms */
    .form-group {
      margin-bottom: var(--space-lg);
    }

    .form-label {
      display: block;
      margin-bottom: var(--space-sm);
      font-weight: 500;
    }

    .form-control {
      width: 100%;
      padding: 0.65rem 0.85rem;
      font-size: 1rem;
      line-height: 1.5;
      background-color: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      transition: all var(--transition-fast);
    }

    .form-control:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: var(--shadow-focus);
    }

    textarea.form-control {
      min-height: 100px;
      resize: vertical;
    }

    /* Custom file input styling */
    .file-input-container {
      position: relative;
      display: flex;
      flex-direction: column;
      width: 100%;
    }

    .file-input {
      position: absolute;
      left: -9999px;
      opacity: 0;
      width: 0.1px;
      height: 0.1px;
      overflow: hidden;
    }

    .file-input-label {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.8rem 1rem;
      background-color: var(--surface);
      color: var(--foreground);
      border-radius: var(--radius-md);
      font-weight: 500;
      cursor: pointer;
      transition: all var(--transition-fast);
      border: 1px dashed var(--border);
      text-align: center;
      margin-bottom: var(--space-md);
    }

    .file-input-label:hover {
      background-color: var(--surface-hover);
      border-color: var(--border-hover);
    }

    .file-input-label span {
      display: flex;
      align-items: center;
    }

    .file-input-label svg {
      margin-right: 8px;
    }

    .file-name-display {
      margin-top: var(--space-sm);
      padding: var(--space-sm) var(--space-md);
      background-color: var(--card);
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      display: none;
      align-items: center;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .file-name-display.active {
      display: flex;
    }

    .file-name-clear {
      margin-left: auto;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background-color: var(--surface);
      color: var(--muted);
      transition: all var(--transition-fast);
    }

    .file-name-clear:hover {
      background-color: var(--error);
      color: white;
    }

    /* Tabs */
    .tabs {
      display: flex;
      border-bottom: 1px solid var(--border);
      margin-bottom: var(--space-lg);
      overflow-x: auto;
      scrollbar-width: none;
      -ms-overflow-style: none;
      scroll-behavior: smooth;
      position: relative;
    }

    .tabs::-webkit-scrollbar {
      display: none;
    }

    .tab {
      padding: 0.75rem 1.25rem;
      cursor: pointer;
      font-weight: 500;
      position: relative;
      white-space: nowrap;
      color: var(--muted);
      transition: color var(--transition-fast);
    }

    .tab:hover {
      color: var(--foreground);
    }

    .tab.active {
      color: var(--primary);
      background-color: var(--tab-active);
      border-radius: var(--radius-md) var(--radius-md) 0 0;
    }

    .tab.active::after {
      content: '';
      position: absolute;
      left: 0;
      right: 0;
      bottom: -1px;
      height: 2px;
      background-color: var(--primary);
      animation: slideInLeft 0.3s ease-out forwards;
    }

    @keyframes slideInLeft {
      from { transform: scaleX(0); }
      to { transform: scaleX(1); }
    }

    .tab-content {
      display: none;
      animation: fadeIn 0.3s ease-out;
    }

    .tab-content.active {
      display: block;
    }

    /* Tables */
    .table-container {
      overflow-x: auto;
      border-radius: var(--radius-md);
      background-color: var(--card);
      border: 1px solid var(--border);
      max-width: 100%;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }

    th, td {
      padding: 0.75rem 1rem;
      text-align: left;
    }

    th {
      background-color: var(--surface);
      font-weight: 600;
      color: var(--foreground);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    tr:not(:last-child) td {
      border-bottom: 1px solid var(--border);
    }

    tr:hover td {
      background-color: var(--surface-hover);
    }

    /* Data cards for mobile display */
    .data-card {
      background-color: var(--card);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-sm);
      margin-bottom: var(--space-md);
      padding: var(--space-md);
      border: 1px solid var(--border);
      transition: all var(--transition-normal);
    }

    .data-card:hover {
      box-shadow: var(--shadow-md);
      border-color: var(--border-hover);
    }

    .data-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-sm);
      padding-bottom: var(--space-sm);
      border-bottom: 1px solid var(--border);
    }

    .data-card-title {
      font-weight: 600;
      margin: 0;
    }

    .data-card-content {
      margin-bottom: var(--space-md);
    }

    .data-card-actions {
      display: flex;
      gap: var(--space-sm);
    }

    /* CodeMirror customization */
    .editor-container {
      position: relative;
      border-radius: var(--radius-md);
      overflow: hidden;
      height: 400px;
      margin-bottom: var(--space-md);
    }

    .editor-container.fullscreen {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      width: 100%;
      height: 100%;
      z-index: 1000;
      background-color: var(--background);
      padding: var(--space-lg);
      margin: 0;
      border-radius: 0;
    }

    .CodeMirror {
      height: 100%;
      font-family: var(--font-mono);
      line-height: 1.6;
      border-radius: var(--radius-md);
      transition: all var(--transition-normal);
    }

    /* Desktop font size for CodeMirror */
    @media (min-width: 769px) {
      .CodeMirror {
        font-size: 12px;
      }
    }

    /* Mobile font size for CodeMirror */
    @media (max-width: 768px) {
      .CodeMirror {
        font-size: 12px;
      }
    }

    .dark-mode .CodeMirror {
      box-shadow: none;
    }

    .editor-toolbar {
      display: flex;
      justify-content: flex-end;
      padding: var(--space-sm);
      background-color: var(--surface);
      border-top: 1px solid var(--border);
    }

    .fullscreen-toggle {
      position: absolute;
      top: var(--space-sm);
      right: var(--space-sm);
      z-index: 100;
      background-color: rgba(0, 0, 0, 0.6);
      color: white;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background-color var(--transition-fast);
      border: none;
      font-size: 1.1rem;
    }

    .fullscreen-toggle:hover {
      background-color: rgba(0, 0, 0, 0.8);
    }

    /* Theme toggle - Repositioned to navbar */
    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--space-md);
      position: sticky;
      top: 0;
      background-color: var(--background);
      z-index: 100;
      box-shadow: var(--shadow-sm);
      border-bottom: 1px solid var(--border);
    }
    
    .theme-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: transparent;
      color: var(--foreground);
      border: 1px solid var(--border);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      transition: all var(--transition-fast);
      z-index: 10;
    }

    .theme-toggle:hover {
      background-color: var(--surface-hover);
      border-color: var(--border-hover);
    }

    /* Toast notifications */
    .toast-container {
      position: fixed;
      top: var(--space-lg);
      right: var(--space-lg);
      z-index: 9999;
    }

    .toast {
      background-color: var(--toast-bg);
      color: var(--toast-text);
      padding: var(--space-md) var(--space-lg);
      border-radius: var(--radius-md);
      margin-bottom: var(--space-sm);
      display: flex;
      align-items: center;
      box-shadow: var(--shadow-md);
      transform: translateX(120%);
      transition: transform var(--transition-normal);
      max-width: 350px;
      opacity: 0.98;
    }

    .toast.show {
      transform: translateX(0);
    }

    .toast-icon {
      margin-right: var(--space-md);
      font-size: 1.5rem;
    }

    .toast.success .toast-icon {
      color: var(--success);
    }

    .toast.error .toast-icon {
      color: var(--error);
    }

    .toast.warning .toast-icon {
      color: var(--warning);
    }

    /* Loader */
    .loader-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      backdrop-filter: blur(5px);
      opacity: 0;
      pointer-events: none;
      transition: opacity var(--transition-normal);
    }

    .loader-overlay.active {
      opacity: 1;
      pointer-events: all;
    }

    .loader {
      width: 48px;
      height: 48px;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: var(--primary);
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Mobile action bar */
    .mobile-action-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: var(--card);
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
      padding: var(--space-sm);
      display: none;
      gap: var(--space-sm);
      z-index: 900;
      transition: transform var(--transition-normal);
      transform: translateY(100%);
    }

    .mobile-action-bar.active {
      transform: translateY(0);
    }

    /* Code content container */
    .code-content {
      background-color: var(--surface);
      border-radius: var(--radius-md);
      padding: var(--space-sm);
      margin-bottom: var(--space-md);
      max-height: 150px;
      overflow-y: auto;
      font-family: var(--font-mono);
      font-size: 0.9rem;
      line-height: 1.5;
      white-space: pre-wrap;
      word-break: break-word;
    }

    /* Mobile specific styles */
    @media (max-width: 768px) {
      html, body {
        font-size: 15px;
      }
      
      .container {
        padding: 0 var(--space-md);
      }
      
      .header h1 {
        font-size: 1.5rem;
      }
      
      .main-content {
        padding: var(--space-md) 0 calc(var(--space-md) + var(--footer-height));
      }
      
      .card {
        border-radius: var(--radius-md);
        margin-bottom: var(--space-lg);
      }
      
      .card-header, .card-body {
        padding: var(--space-md);
      }
      
      .form-group {
        margin-bottom: var(--space-md);
      }
      
      .btn-group {
        flex-wrap: wrap;
      }
      
      .mobile-action-bar {
        display: flex;
      }
      
      .action-btn-desktop {
        display: none;
      }
      
      .tab {
        padding: 0.6rem 1rem;
        font-size: 0.9rem;
      }
      
      .editor-container {
        height: 300px;
      }
      
      /* Hide tables on mobile and show cards instead */
      .mobile-hide {
        display: none;
      }
      
      .mobile-show {
        display: block;
      }
      
      /* Make fullscreen editor better on mobile */
      .editor-container.fullscreen .CodeMirror {
        font-size: 10px !important;
        line-height: 1.6;
      }
      
      .fullscreen-toolbar {
        padding: var(--space-sm);
      }
    }

    /* Hide mobile cards on desktop */
    .mobile-show {
      display: none;
    }

    /* Dark mode CodeMirror overrides */
    .dark-mode .CodeMirror {
      background-color: var(--cm-background);
      color: var(--cm-foreground);
      border-color: var(--cm-border);
    }

    .dark-mode .CodeMirror-gutters {
      background-color: #1a1a1a;
      border-color: var(--cm-border);
    }

    .dark-mode .CodeMirror-linenumber {
      color: #606060;
    }

    /* Utility classes */
    .hidden {
      display: none !important;
    }
    
    .d-flex {
      display: flex;
    }
    
    .flex-column {
      flex-direction: column;
    }
    
    .justify-content-between {
      justify-content: space-between;
    }
    
    .align-items-center {
      align-items: center;
    }
    
    .flex-wrap {
      flex-wrap: wrap;
    }
    
    .gap-sm {
      gap: var(--space-sm);
    }
    
    .gap-md {
      gap: var(--space-md);
    }
    
    .mb-sm {
      margin-bottom: var(--space-sm);
    }
    
    .mb-md {
      margin-bottom: var(--space-md);
    }
    
    .mb-lg {
      margin-bottom: var(--space-lg);
    }
    
    .mt-sm {
      margin-top: var(--space-sm);
    }
    
    .mt-md {
      margin-top: var(--space-md);
    }
    
    .mt-lg {
      margin-top: var(--space-lg);
    }
    
    .mr-sm {
      margin-right: var(--space-sm);
    }
    
    .ml-sm {
      margin-left: var(--space-sm);
    }
    
    .text-center {
      text-align: center;
    }
    
    .w-100 {
      width: 100%;
    }
    
    .fade-in {
      animation: fadeIn 0.3s ease-out;
    }
    
    .fade-in-up {
      animation: fadeInUp 0.5s ease-out;
    }
  </style>
</head>
<body>
  <!-- Loader -->
  <div class="loader-overlay" id="loader">
    <div class="loader"></div>
  </div>
  
  <!-- Toast notifications -->
  <div class="toast-container" id="toast-container"></div>
  
  <!-- Header -->
  <header class="header">
    <div class="container">
      <div class="header-content">
        <h1>ğŸš€ Sing-Box é…ç½®ç®¡ç†å¹³å° ğŸš€</h1>
      </div>
    </div>
  </header>
  
  <!-- Navbar with theme toggle -->
  <nav class="navbar">
    <div class="container d-flex justify-content-between align-items-center">
      <div></div> <!-- Placeholder for balance -->
      <button id="theme-toggle" class="theme-toggle" aria-label="åˆ‡æ¢ä¸»é¢˜">ğŸŒ™</button>
    </div>
  </nav>
  
  <!-- Main Content -->
  <main class="main-content">
    <div class="container">
      <!-- Login Section -->
      <div id="login-section" class="card fade-in-up">
        <div class="card-body text-center">
          <h2>ğŸ”’ è¯·ç™»å½•</h2>
          <div class="form-group">
            <input type="password" id="login-password" class="form-control" placeholder="è¯·è¾“å…¥ç™»å½•å¯†ç " autocomplete="current-password">
          </div>
          <button class="btn" id="login-btn">ç™»å½•</button>
        </div>
      </div>
      
      <!-- Main Management Section -->
      <div id="main-section" class="hidden">
        <!-- Tabs Navigation -->
        <div class="tabs" id="main-tabs">
          <div class="tab active" data-tab="config">ğŸ“ é…ç½®ç¼–è¾‘</div>
          <div class="tab" data-tab="endpoints">ğŸ”Œ Endpoints</div>
          <div class="tab" data-tab="history">ğŸ“œ å†å²ç‰ˆæœ¬</div>
        </div>
        
        <!-- Config Tab -->
        <div id="config-tab" class="tab-content active">
          <div class="card fade-in">
            <div class="card-header">
              <h2>ğŸ“ é…ç½®ç¼–è¾‘</h2>
            </div>
            <div class="card-body">
              <div class="editor-container" id="config-editor-container">
                <textarea id="config-editor" placeholder="åŠ è½½é…ç½®ä¸­..."></textarea>
                <button class="fullscreen-toggle" id="config-fullscreen" aria-label="å…¨å±ç¼–è¾‘">â›¶</button>
              </div>
              <div class="d-flex gap-sm flex-wrap action-btn-desktop">
                <button class="btn" id="save-config-btn">
                  <span>ğŸ’¾ ä¿å­˜é…ç½®</span>
                </button>
                <button class="btn" id="format-config-btn">
                  <span>ğŸ”§ æ ¼å¼åŒ– JSON</span>
                </button>
              </div>
            </div>
          </div>
          
          <div class="card fade-in">
            <div class="card-header">
              <h3>ğŸ“¤ ä¸Šä¼ é…ç½®æ–‡ä»¶</h3>
            </div>
            <div class="card-body">
              <div class="file-input-container">
                <input type="file" id="upload-config" class="file-input" accept=".json">
                <label for="upload-config" class="file-input-label">
                  <span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                      <polyline points="17 8 12 3 7 8"></polyline>
                      <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                    é€‰æ‹©æ–‡ä»¶
                  </span>
                </label>
                <div id="file-name-display" class="file-name-display">
                  <span id="selected-file-name">No file selected</span>
                  <span id="clear-file-selection" class="file-name-clear">Ã—</span>
                </div>
              </div>
              <button class="btn" id="upload-config-btn">
                <span>ğŸ“¤ ä¸Šä¼ é…ç½®æ–‡ä»¶</span>
              </button>
            </div>
          </div>
          
          <div class="card fade-in">
            <div class="card-header">
              <h3>ğŸ”— Raw é“¾æ¥ç”Ÿæˆ</h3>
            </div>
            <div class="card-body">
              <div class="form-group">
                <label class="form-label">è¯·è¾“å…¥ Raw è®¿é—®å¯†ç ï¼š</label>
                <input type="password" id="raw-password" class="form-control" placeholder="Raw è®¿é—®å¯†ç ">
              </div>
              <div class="form-group">
                <label class="form-label">é€‰æ‹© Endpointsï¼ˆå¯é€‰ï¼‰ï¼š</label>
                <select id="raw-endpoint" class="form-control">
                  <option value="">ä¸æ›¿æ¢</option>
                </select>
              </div>
              <button class="btn" id="generate-raw-link-btn">
                <span>ç”Ÿæˆ Raw é“¾æ¥</span>
              </button>
              <div id="raw-link-display" class="form-group mt-md" style="display: none;">
                <div class="form-control" style="word-break: break-all; min-height: 60px; font-family: var(--font-mono); white-space: normal; padding: var(--space-md);"></div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Endpoints Tab -->
        <div id="endpoints-tab" class="tab-content">
          <div class="card fade-in">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h2>ğŸ”Œ Endpoints ç®¡ç†</h2>
              <button class="btn" id="refresh-endpoints-btn">
                <span>ğŸ”„ åˆ·æ–°åˆ—è¡¨</span>
              </button>
            </div>
            <div class="card-body">
              <!-- Desktop table view -->
              <div class="table-container table-responsive mb-lg mobile-hide">
                <table id="endpoints-table">
                  <thead>
                    <tr>
                      <th style="width: 20%">Key</th>
                      <th style="width: 60%">é…ç½®å†…å®¹</th>
                      <th style="width: 20%">æ“ä½œ</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td colspan="3" class="text-center">åŠ è½½ä¸­...</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              
              <!-- Mobile card view -->
              <div id="endpoints-cards" class="mobile-show">
                <div class="text-center">åŠ è½½ä¸­...</div>
              </div>
            </div>
          </div>
          
          <div class="card fade-in">
            <div class="card-header">
              <h3>â• æ·»åŠ  / ä¿®æ”¹ Endpoints</h3>
            </div>
            <div class="card-body">
              <div class="form-group">
                <label class="form-label">Key:</label>
                <input type="text" id="endpoint-key" class="form-control" placeholder="ä¾‹å¦‚ï¼šdefault">
              </div>
              
              <div class="form-group">
                <label class="form-label">Endpoints JSON å†…å®¹:</label>
                <div class="editor-container" id="endpoint-editor-container">
                  <textarea id="endpoint-content" placeholder='ä¾‹å¦‚: [{"type": "wireguard", ...}]'></textarea>
                  <button class="fullscreen-toggle" id="endpoint-fullscreen" aria-label="å…¨å±ç¼–è¾‘">â›¶</button>
                </div>
              </div>
              
              <div class="d-flex gap-sm flex-wrap">
                <button class="btn" id="save-endpoint-btn">
                  <span>ğŸ’¾ ä¿å­˜ Endpoints</span>
                </button>
                <button class="btn btn-outline" id="clear-endpoint-btn">
                  <span>ğŸ§¹ æ¸…ç©º</span>
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- History Tab -->
        <div id="history-tab" class="tab-content">
          <div class="card fade-in">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h2>ğŸ“œ å†å²ç‰ˆæœ¬ç®¡ç†</h2>
              <button class="btn" id="refresh-history-btn">
                <span>ğŸ”„ åˆ·æ–°å†å²åˆ—è¡¨</span>
              </button>
            </div>
            <div class="card-body">
              <!-- Desktop table view -->
              <div class="table-container table-responsive mobile-hide">
                <table id="history-table">
                  <thead>
                    <tr>
                      <th style="width: 70%">æ–‡ä»¶å</th>
                      <th style="width: 30%">æ“ä½œ</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td colspan="2" class="text-center">åŠ è½½ä¸­...</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              
              <!-- Mobile card view -->
              <div id="history-cards" class="mobile-show">
                <div class="text-center">åŠ è½½ä¸­...</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
  
  <!-- Mobile Action Bar -->
  <div class="mobile-action-bar" id="config-actions">
    <button class="btn" id="mobile-save-btn">ğŸ’¾ ä¿å­˜</button>
    <button class="btn" id="mobile-format-btn">ğŸ”§ æ ¼å¼åŒ–</button>
    <button class="btn" id="mobile-fullscreen-btn">ğŸ“± å…¨å±ç¼–è¾‘</button>
  </div>
  
  <!-- Fullscreen Editor Modal -->
  <div class="editor-container fullscreen hidden" id="fullscreen-editor">
    <div class="d-flex justify-content-between align-items-center mb-md">
      <h3 id="fullscreen-title">å…¨å±ç¼–è¾‘å™¨</h3>
      <button class="btn" id="exit-fullscreen-btn">é€€å‡ºå…¨å±</button>
    </div>
    <div id="fullscreen-editor-container" style="height: calc(100% - 110px);"></div>
    <div class="fullscreen-toolbar d-flex justify-content-end gap-sm mt-md">
      <button class="btn" id="fullscreen-save-btn">ä¿å­˜</button>
      <button class="btn" id="fullscreen-format-btn">æ ¼å¼åŒ– JSON</button>
    </div>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Global variables
      let configEditor, endpointEditor, fullscreenEditor;
      let currentConfig = "";
      let isInFullscreenMode = false;
      let currentFullscreenSource = null;
      let isDarkMode = false;
      
      // DOM elements - moved inside DOMContentLoaded to ensure they exist
      const loader = document.getElementById('loader');
      const themeToggle = document.getElementById('theme-toggle');
      const loginSection = document.getElementById('login-section');
      const mainSection = document.getElementById('main-section');
      const mainTabs = document.querySelectorAll('.tab');
      const configTab = document.getElementById('config-tab');
      const endpointsTab = document.getElementById('endpoints-tab');
      const historyTab = document.getElementById('history-tab');
      const fullscreenEditorElement = document.getElementById('fullscreen-editor');
      const mobileActionBar = document.getElementById('config-actions');
      
      // Custom file input handling
      const fileInput = document.getElementById('upload-config');
      const fileNameDisplay = document.getElementById('file-name-display');
      const selectedFileName = document.getElementById('selected-file-name');
      const clearFileSelection = document.getElementById('clear-file-selection');
      
      fileInput.addEventListener('change', function() {
        if (this.files.length > 0) {
          selectedFileName.textContent = this.files[0].name;
          fileNameDisplay.classList.add('active');
        } else {
          fileNameDisplay.classList.remove('active');
        }
      });
      
      clearFileSelection.addEventListener('click', function(e) {
        e.preventDefault();
        fileInput.value = '';
        fileNameDisplay.classList.remove('active');
      });
      
      // Detect mobile device
      const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
      
      // Show/hide mobile action bar based on device
      if (isMobile) {
        mobileActionBar.classList.add('active');
        document.querySelectorAll('.mobile-hide').forEach(el => el.style.display = 'none');
        document.querySelectorAll('.mobile-show').forEach(el => el.style.display = 'block');
      } else {
        document.querySelectorAll('.mobile-hide').forEach(el => el.style.display = 'block');
        document.querySelectorAll('.mobile-show').forEach(el => el.style.display = 'none');
      }
      
      // Utility functions
      function showLoader() {
        loader.classList.add('active');
      }
      
      function hideLoader() {
        loader.classList.remove('active');
      }
      
      function showToast(message, type = 'success') {
        const toastContainer = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        
        const icon = type === 'success' ? 'âœ“' : type === 'error' ? 'âœ—' : 'âš ï¸';
        toast.innerHTML = `
          <div class="toast-icon">${icon}</div>
          <div class="toast-message">${message}</div>
        `;
        
        toastContainer.appendChild(toast);
        
        // Show the toast after a small delay to allow CSS transition to work
        setTimeout(() => toast.classList.add('show'), 10);
        
        // Remove the toast after a delay
        setTimeout(() => {
          toast.classList.remove('show');
          setTimeout(() => toast.remove(), 300);
        }, 3000);
      }
      
      // Theme toggle
      function toggleTheme() {
        isDarkMode = !isDarkMode;
        document.body.classList.toggle('dark-mode', isDarkMode);
        themeToggle.textContent = isDarkMode ? 'â˜€ï¸' : 'ğŸŒ™';
        
        // Update CodeMirror theme
        const theme = isDarkMode ? 'material-darker' : 'eclipse';
        if (configEditor) configEditor.setOption('theme', theme);
        if (endpointEditor) endpointEditor.setOption('theme', theme);
        if (fullscreenEditor) fullscreenEditor.setOption('theme', theme);
        
        // Save preference
        localStorage.setItem('darkMode', isDarkMode ? 'true' : 'false');
      }
      
      // Check for saved theme preference
      function initTheme() {
        const savedTheme = localStorage.getItem('darkMode');
        if (savedTheme === 'true') {
          isDarkMode = false; // Will be toggled to true
          toggleTheme();
        }
      }
      
      // Tab switching
      function switchTab(tabId) {
        // Update tab states
        mainTabs.forEach(tab => {
          tab.classList.toggle('active', tab.getAttribute('data-tab') === tabId);
        });
        
        // Update content visibility
        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.remove('active');
        });
        
        // Show active content
        const activeTabContent = document.getElementById(`${tabId}-tab`);
        if (activeTabContent) {
          activeTabContent.classList.add('active', 'fade-in');
          setTimeout(() => activeTabContent.classList.remove('fade-in'), 300);
        }
        
        // Handle mobile action bar visibility
        if (isMobile) {
          mobileActionBar.classList.toggle('active', tabId === 'config');
        }
        
        // Load content based on tab
        if (tabId === 'endpoints') {
          loadEndpoints();
          initEndpointEditor();
        } else if (tabId === 'config') {
          loadRawEndpoints();
          if (configEditor) setTimeout(() => configEditor.refresh(), 10);
        } else if (tabId === 'history') {
          loadHistory();
        }
      }
      
      // Initialize CodeMirror editors
      function initConfigEditor() {
        if (!configEditor) {
          const editorElement = document.getElementById('config-editor');
          configEditor = CodeMirror.fromTextArea(editorElement, {
            mode: 'application/json',
            lineNumbers: true,
            matchBrackets: true,
            autoCloseBrackets: true,
            theme: isDarkMode ? 'material-darker' : 'eclipse',
            tabSize: 2,
            lineWrapping: true,
            viewportMargin: Infinity
          });
          
          // Optimize for mobile
          if (isMobile) {
            configEditor.setOption('lineWrapping', true);
          }
        }
      }
      
      function initEndpointEditor() {
        if (!endpointEditor) {
          const editorElement = document.getElementById('endpoint-content');
          endpointEditor = CodeMirror.fromTextArea(editorElement, {
            mode: 'application/json',
            lineNumbers: true,
            matchBrackets: true,
            autoCloseBrackets: true,
            theme: isDarkMode ? 'material-darker' : 'eclipse',
            tabSize: 2,
            lineWrapping: true,
            viewportMargin: Infinity
          });
        }
      }
      
      // Fullscreen mode
      function enterFullscreenMode(source) {
        currentFullscreenSource = source;
        isInFullscreenMode = true;
        
        fullscreenEditorElement.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
        
        const contentContainer = document.getElementById('fullscreen-editor-container');
        const textarea = document.createElement('textarea');
        contentContainer.innerHTML = '';
        contentContainer.appendChild(textarea);
        
        // Set the title based on the source
        document.getElementById('fullscreen-title').textContent = 
          source === 'config' ? 'é…ç½®ç¼–è¾‘' : 'Endpoints ç¼–è¾‘';
        
        // Initialize editor with content from source
        if (source === 'config') {
          textarea.value = configEditor.getValue();
        } else if (source === 'endpoint') {
          textarea.value = endpointEditor.getValue();
        }
        
        fullscreenEditor = CodeMirror.fromTextArea(textarea, {
          mode: 'application/json',
          lineNumbers: true,
          matchBrackets: true,
          autoCloseBrackets: true,
          theme: isDarkMode ? 'material-darker' : 'eclipse',
          tabSize: 2,
          lineWrapping: true,
          viewportMargin: Infinity
        });
        
        // Set desktop font size for the fullscreen editor
        if (!isMobile) {
          fullscreenEditor.getWrapperElement().style.fontSize = '14px';
        }
        
        // Ensure CodeMirror is properly sized and rendered
        setTimeout(() => fullscreenEditor.refresh(), 10);
        
        // Update button states
        document.getElementById('fullscreen-save-btn').disabled = source !== 'config';
      }
      
      function exitFullscreenMode() {
        if (!isInFullscreenMode) return;
        
        // Transfer content back to original editor
        if (currentFullscreenSource === 'config' && configEditor) {
          configEditor.setValue(fullscreenEditor.getValue());
        } else if (currentFullscreenSource === 'endpoint' && endpointEditor) {
          endpointEditor.setValue(fullscreenEditor.getValue());
        }
        
        // Hide fullscreen editor
        fullscreenEditorElement.classList.add('hidden');
        document.body.style.overflow = '';
        
        isInFullscreenMode = false;
        currentFullscreenSource = null;
      }
      
      // API functions
      function login() {
        const password = document.getElementById('login-password').value;
        
        if (!password) {
          showToast('è¯·è¾“å…¥å¯†ç ', 'error');
          return;
        }
        
        showLoader();
        
        fetch('login.php', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({password: password})
        })
        .then(response => response.json())
        .then(data => {
          hideLoader();
          if (data.success) {
            loginSection.classList.add('hidden');
            mainSection.classList.remove('hidden');
            mainSection.classList.add('fade-in');
            
            // Initialize the app
            loadConfig();
            loadRawEndpoints();
            showToast('ç™»å½•æˆåŠŸ');
          } else {
            showToast('ç™»å½•å¤±è´¥ï¼Œå¯†ç é”™è¯¯', 'error');
            
            // Add shake animation to password input
            const passwordInput = document.getElementById('login-password');
            passwordInput.classList.add('animate__animated', 'animate__shakeX');
            setTimeout(() => {
              passwordInput.classList.remove('animate__animated', 'animate__shakeX');
            }, 1000);
          }
        })
        .catch(err => {
          hideLoader();
          console.error("ç™»å½•é”™è¯¯:", err);
          showToast('ç™»å½•å‡ºé”™ï¼Œè¯·é‡è¯•', 'error');
        });
      }
      
      function loadConfig() {
        showLoader();
        
        fetch('get_config.php')
        .then(response => response.json())
        .then(data => {
          hideLoader();
          
          // Initialize the editor if needed
          initConfigEditor();
          
          // Set the config content
          currentConfig = JSON.stringify(data, null, 2);
          configEditor.setValue(currentConfig);
          
          // Set desktop font size
          if (!isMobile) {
            configEditor.getWrapperElement().style.fontSize = '14px';
          }
          
          // Refresh to ensure proper rendering
          setTimeout(() => configEditor.refresh(), 10);
        })
        .catch(err => {
          hideLoader();
          console.error("åŠ è½½é…ç½®é”™è¯¯:", err);
          showToast('åŠ è½½é…ç½®å‡ºé”™', 'error');
        });
      }
      
      function saveConfig() {
        // Get the content from the appropriate editor
        let configData;
        
        if (isInFullscreenMode && currentFullscreenSource === 'config') {
          configData = fullscreenEditor.getValue();
        } else {
          configData = configEditor.getValue();
        }
        
        // Validate JSON
        try {
          JSON.parse(configData);
        } catch(e) {
          showToast('é…ç½®å†…å®¹ä¸æ˜¯æœ‰æ•ˆçš„ JSON æ ¼å¼', 'error');
          return;
        }
        
        showLoader();
        
        fetch('save_json.php', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({json: configData})
        })
        .then(response => response.json())
        .then(data => {
          hideLoader();
          
          if (data.success) {
            showToast('é…ç½®ä¿å­˜æˆåŠŸ');
            loadConfig();
            
            // Exit fullscreen mode if active
            if (isInFullscreenMode) {
              exitFullscreenMode();
            }
          } else {
            showToast('ä¿å­˜å¤±è´¥ï¼š' + data.error, 'error');
          }
        })
        .catch(err => {
          hideLoader();
          console.error("ä¿å­˜é…ç½®é”™è¯¯:", err);
          showToast('ä¿å­˜é…ç½®å‡ºé”™', 'error');
        });
      }
      
      function formatConfig() {
        let configData;
        
        if (isInFullscreenMode && currentFullscreenSource === 'config') {
          configData = fullscreenEditor.getValue();
        } else if (isInFullscreenMode && currentFullscreenSource === 'endpoint') {
          configData = fullscreenEditor.getValue();
        } else if (currentFullscreenSource === null && document.getElementById('config-tab').classList.contains('active')) {
          configData = configEditor.getValue();
        } else if (currentFullscreenSource === null && document.getElementById('endpoints-tab').classList.contains('active')) {
          configData = endpointEditor.getValue();
        }
        
        try {
          let parsed = JSON.parse(configData);
          let formatted = JSON.stringify(parsed, null, 2);
          
          if (isInFullscreenMode) {
            fullscreenEditor.setValue(formatted);
          } else if (document.getElementById('config-tab').classList.contains('active')) {
            configEditor.setValue(formatted);
          } else if (document.getElementById('endpoints-tab').classList.contains('active')) {
            endpointEditor.setValue(formatted);
          }
          
          showToast('JSON æ ¼å¼åŒ–æˆåŠŸ');
        } catch(e) {
          showToast('å½“å‰å†…å®¹ä¸æ˜¯æœ‰æ•ˆçš„ JSON æ ¼å¼ï¼Œæ— æ³•æ ¼å¼åŒ–', 'error');
        }
      }
      
      function uploadConfig() {
        const fileInput = document.getElementById('upload-config');
        
        if (fileInput.files.length === 0) {
          showToast('è¯·é€‰æ‹©ä¸€ä¸ªé…ç½®æ–‡ä»¶è¿›è¡Œä¸Šä¼ ', 'error');
          return;
        }
        
        const file = fileInput.files[0];
        const formData = new FormData();
        formData.append('jsonFile', file);
        
        showLoader();
        
        fetch('upload_json.php', {
          method: 'POST',
          body: formData
        })
        .then(response => response.json())
        .then(data => {
          hideLoader();
          
          if (data.success) {
            showToast('é…ç½®æ–‡ä»¶ä¸Šä¼ æˆåŠŸ');
            loadConfig();
            
            // Clear file input
            fileInput.value = '';
            document.getElementById('file-name-display').classList.remove('active');
          } else {
            showToast('ä¸Šä¼ å¤±è´¥ï¼š' + data.error, 'error');
          }
        })
        .catch(err => {
          hideLoader();
          console.error("ä¸Šä¼ é…ç½®é”™è¯¯:", err);
          showToast('ä¸Šä¼ é…ç½®å‡ºé”™', 'error');
        });
      }
      
      function loadRawEndpoints() {
        showLoader();
        
        fetch('endpoints_manager.php', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({action: 'list'})
        })
        .then(response => response.json())
        .then(data => {
          hideLoader();
          
          if (data.success) {
            const select = document.getElementById('raw-endpoint');
            select.innerHTML = '<option value="">ä¸æ›¿æ¢</option>';
            
            for (let key in data.endpoints) {
              const option = document.createElement('option');
              option.value = key;
              option.textContent = key;
              select.appendChild(option);
            }
          } else {
            console.error("åŠ è½½ Raw endpoints å¤±è´¥ï¼š" + data.error);
            showToast('åŠ è½½ Endpoints åˆ—è¡¨å¤±è´¥', 'error');
          }
        })
        .catch(err => {
          hideLoader();
          console.error("åŠ è½½ Raw endpoints é”™è¯¯:", err);
          showToast('åŠ è½½ Endpoints åˆ—è¡¨å‡ºé”™', 'error');
        });
      }
      
      function generateRawLink() {
        const rawPwd = document.getElementById('raw-password').value;
        
        if (!rawPwd) {
          showToast('è¯·è¾“å…¥ Raw è®¿é—®å¯†ç ', 'error');
          return;
        }
        
        // Generate link with selected endpoint
        let rawLink = "https://sing-box.200502.xyz/raw.php?pwd=" + encodeURIComponent(rawPwd) + "&file=config.json";
        const selectedEp = document.getElementById('raw-endpoint').value;
        
        if (selectedEp) {
          rawLink += "&ep=" + encodeURIComponent(selectedEp);
        }
        
        // Display the link
        const linkDisplay = document.getElementById('raw-link-display');
        linkDisplay.style.display = 'block';
        linkDisplay.querySelector('div').textContent = rawLink;
        
        // Add animation
        linkDisplay.classList.add('fade-in');
        setTimeout(() => linkDisplay.classList.remove('fade-in'), 500);
        
        showToast('Raw é“¾æ¥ç”ŸæˆæˆåŠŸ');
      }
      
      function loadEndpoints() {
        showLoader();
        
        fetch('endpoints_manager.php', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({action: 'list'})
        })
        .then(response => response.json())
        .then(data => {
          hideLoader();
          
          if (data.success) {
            // Update desktop table view
            const tbody = document.querySelector('#endpoints-table tbody');
            tbody.innerHTML = '';
            
            // Update mobile card view
            const cardsContainer = document.getElementById('endpoints-cards');
            cardsContainer.innerHTML = '';
            
            if (Object.keys(data.endpoints).length === 0) {
              // Handle empty data for desktop
              const tr = document.createElement('tr');
              const td = document.createElement('td');
              td.colSpan = 3;
              td.className = 'text-center';
              td.textContent = 'æš‚æ— æ•°æ®';
              tr.appendChild(td);
              tbody.appendChild(tr);
              
              // Handle empty data for mobile
              cardsContainer.innerHTML = '<div class="text-center">æš‚æ— æ•°æ®</div>';
              return;
            }
            
            let animationDelay = 0;
            
            for (let key in data.endpoints) {
              // Create formatted JSON content
              const jsonText = JSON.stringify(data.endpoints[key], null, 2);
              
              // Desktop view row
              const tr = document.createElement('tr');
              tr.classList.add('fade-in-up');
              tr.style.animationDelay = `${animationDelay}s`;
              
              // Key cell
              const tdKey = document.createElement('td');
              tdKey.textContent = key;
              
              // Content cell with code highlighting
              const tdContent = document.createElement('td');
              const pre = document.createElement('pre');
              pre.style.backgroundColor = isDarkMode ? '#1a1a1a' : '#f6f8fa';
              pre.style.borderRadius = '4px';
              pre.style.padding = '8px';
              pre.style.maxHeight = '150px';
              pre.style.overflowX = 'auto';
              
              const code = document.createElement('code');
              code.className = 'json';
              
              // Format and highlight JSON
              CodeMirror.runMode(jsonText, 'application/json', code);
              
              pre.appendChild(code);
              tdContent.appendChild(pre);
              
              // Actions cell
              const tdActions = document.createElement('td');
              const btnGroup = document.createElement('div');
              btnGroup.className = 'd-flex gap-sm';
              
              // Edit button
              const editBtn = document.createElement('button');
              editBtn.className = 'action-btn edit';
              editBtn.textContent = 'ç¼–è¾‘';
              editBtn.onclick = function() {
                editEndpoint(key, data.endpoints[key]);
              };
              
              // Delete button
              const deleteBtn = document.createElement('button');
              deleteBtn.className = 'action-btn delete';
              deleteBtn.textContent = 'åˆ é™¤';
              deleteBtn.onclick = function() {
                if (confirm(`ç¡®è®¤åˆ é™¤ endpoints "${key}" å—ï¼Ÿ`)) {
                  deleteEndpoint(key);
                }
              };
              
              btnGroup.appendChild(editBtn);
              btnGroup.appendChild(deleteBtn);
              tdActions.appendChild(btnGroup);
              
              // Append cells to row
              tr.appendChild(tdKey);
              tr.appendChild(tdContent);
              tr.appendChild(tdActions);
              tbody.appendChild(tr);
              
              // Mobile card view
              const card = document.createElement('div');
              card.className = 'data-card fade-in-up';
              card.style.animationDelay = `${animationDelay}s`;
              
              const cardHeader = document.createElement('div');
              cardHeader.className = 'data-card-header';
              
              const cardTitle = document.createElement('h4');
              cardTitle.className = 'data-card-title';
              cardTitle.textContent = key;
              cardHeader.appendChild(cardTitle);
              
              const cardContent = document.createElement('div');
              cardContent.className = 'data-card-content';
              
              const codeContent = document.createElement('div');
              codeContent.className = 'code-content';
              
              // Truncate JSON content for mobile display
              let displayJson = jsonText;
              if (displayJson.length > 200) {
                displayJson = displayJson.substring(0, 200) + '...';
              }
              codeContent.textContent = displayJson;
              
              cardContent.appendChild(codeContent);
              
              const cardActions = document.createElement('div');
              cardActions.className = 'data-card-actions';
              
              // Clone the buttons for mobile
              const mobileEditBtn = document.createElement('button');
              mobileEditBtn.className = 'btn btn-sm';
              mobileEditBtn.textContent = 'ç¼–è¾‘';
              mobileEditBtn.onclick = function() {
                editEndpoint(key, data.endpoints[key]);
              };
              
              const mobileDeleteBtn = document.createElement('button');
              mobileDeleteBtn.className = 'btn btn-sm btn-danger';
              mobileDeleteBtn.textContent = 'åˆ é™¤';
              mobileDeleteBtn.onclick = function() {
                if (confirm(`ç¡®è®¤åˆ é™¤ endpoints "${key}" å—ï¼Ÿ`)) {
                  deleteEndpoint(key);
                }
              };
              
              cardActions.appendChild(mobileEditBtn);
              cardActions.appendChild(mobileDeleteBtn);
              
              card.appendChild(cardHeader);
              card.appendChild(cardContent);
              card.appendChild(cardActions);
              
              cardsContainer.appendChild(card);
              
              animationDelay += 0.05;
            }
            
            // Remove animation classes after animation completes
            setTimeout(() => {
              document.querySelectorAll('#endpoints-table tbody tr, .data-card').forEach(el => {
                el.classList.remove('fade-in-up');
              });
            }, 1000);
          } else {
            showToast('åŠ è½½ endpoints å¤±è´¥ï¼š' + data.error, 'error');
          }
        })
        .catch(err => {
          hideLoader();
          console.error("åŠ è½½ endpoints é”™è¯¯:", err);
          showToast('åŠ è½½ endpoints å‡ºé”™', 'error');
        });
      }
      
      function editEndpoint(key, data) {
        document.getElementById('endpoint-key').value = key;
        
        const jsonContent = JSON.stringify(data, null, 2);
        
        if (endpointEditor) {
          endpointEditor.setValue(jsonContent);
          // Set desktop font size
          if (!isMobile) {
            endpointEditor.getWrapperElement().style.fontSize = '14px';
          }
          setTimeout(() => endpointEditor.refresh(), 10);
        } else {
          initEndpointEditor();
          endpointEditor.setValue(jsonContent);
        }
        
        // Scroll to editor form
        document.querySelector('#endpoints-tab .card:nth-child(2)').scrollIntoView({ 
          behavior: 'smooth', 
          block: 'start' 
        });
      }
      
      function saveEndpoint() {
        const key = document.getElementById('endpoint-key').value.trim();
        let content;
        
        if (endpointEditor) {
          content = endpointEditor.getValue().trim();
        } else {
          content = document.getElementById('endpoint-content').value.trim();
        }
        
        if (!key || !content) {
          showToast('Key å’Œå†…å®¹ä¸èƒ½ä¸ºç©º', 'error');
          return;
        }
        
        // Validate JSON
        let endpointData;
        try {
          endpointData = JSON.parse(content);
        } catch(e) {
          showToast('Endpoints å†…å®¹ä¸æ˜¯æœ‰æ•ˆçš„ JSON æ ¼å¼', 'error');
          return;
        }
        
        showLoader();
        
        fetch('endpoints_manager.php', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({action: 'update', key: key, data: endpointData})
        })
        .then(response => response.json())
        .then(data => {
          hideLoader();
          
          if (data.success) {
            showToast('Endpoints ä¿å­˜æˆåŠŸ');
            loadEndpoints();
            clearEndpointForm();
          } else {
            showToast('ä¿å­˜å¤±è´¥ï¼š' + data.error, 'error');
          }
        })
        .catch(err => {
          hideLoader();
          console.error("ä¿å­˜ endpoints é”™è¯¯:", err);
          showToast('ä¿å­˜ endpoints å‡ºé”™', 'error');
        });
      }
      
      function deleteEndpoint(key) {
        showLoader();
        
        fetch('endpoints_manager.php', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({action: 'delete', key: key})
        })
        .then(response => response.json())
        .then(data => {
          hideLoader();
          
          if (data.success) {
            showToast('Endpoints åˆ é™¤æˆåŠŸ');
            loadEndpoints();
          } else {
            showToast('åˆ é™¤å¤±è´¥ï¼š' + data.error, 'error');
          }
        })
        .catch(err => {
          hideLoader();
          console.error("åˆ é™¤ endpoints é”™è¯¯:", err);
          showToast('åˆ é™¤ endpoints å‡ºé”™', 'error');
        });
      }
      
      function clearEndpointForm() {
        document.getElementById('endpoint-key').value = '';
        
        if (endpointEditor) {
          endpointEditor.setValue('');
        } else {
          document.getElementById('endpoint-content').value = '';
        }
        
        showToast('è¡¨å•å·²æ¸…ç©º');
      }
      
      function loadHistory() {
        showLoader();
        
        fetch('get_history.php')
        .then(response => response.json())
        .then(data => {
          hideLoader();
          
          if (data.success) {
            // Update desktop table view
            const tbody = document.querySelector('#history-table tbody');
            tbody.innerHTML = '';
            
            // Update mobile card view
            const cardsContainer = document.getElementById('history-cards');
            cardsContainer.innerHTML = '';
            
            if (data.history.length === 0) {
              // Handle empty data for desktop
              const tr = document.createElement('tr');
              const td = document.createElement('td');
              td.colSpan = 2;
              td.className = 'text-center';
              td.textContent = 'æš‚æ— å†å²ç‰ˆæœ¬';
              tr.appendChild(td);
              tbody.appendChild(tr);
              
              // Handle empty data for mobile
              cardsContainer.innerHTML = '<div class="text-center">æš‚æ— å†å²ç‰ˆæœ¬</div>';
              return;
            }
            
            let animationDelay = 0;
            
            data.history.forEach(item => {
              // Desktop table row
              const tr = document.createElement('tr');
              tr.classList.add('fade-in-up');
              tr.style.animationDelay = `${animationDelay}s`;
              
              // Filename cell
              const tdFile = document.createElement('td');
              tdFile.textContent = item;
              
              // Actions cell
              const tdActions = document.createElement('td');
              const btnGroup = document.createElement('div');
              btnGroup.className = 'd-flex gap-sm';
              
              // Restore button
              const restoreBtn = document.createElement('button');
              restoreBtn.className = 'action-btn edit';
              restoreBtn.textContent = 'æ¢å¤';
              restoreBtn.onclick = function() {
                if (confirm(`ç¡®è®¤æ¢å¤ "${item}" çš„ç‰ˆæœ¬å—ï¼Ÿ`)) {
                  restoreHistory(item);
                }
              };
              
              // Delete button
              const deleteBtn = document.createElement('button');
              deleteBtn.className = 'action-btn delete';
              deleteBtn.textContent = 'åˆ é™¤';
              deleteBtn.onclick = function() {
                if (confirm(`ç¡®è®¤åˆ é™¤å†å²ç‰ˆæœ¬ "${item}" å—ï¼Ÿ`)) {
                  deleteHistory(item);
                }
              };
              
              btnGroup.appendChild(restoreBtn);
              btnGroup.appendChild(deleteBtn);
              tdActions.appendChild(btnGroup);
              
              // Append cells to row
              tr.appendChild(tdFile);
              tr.appendChild(tdActions);
              tbody.appendChild(tr);
              
              // Mobile card view
              const card = document.createElement('div');
              card.className = 'data-card fade-in-up';
              card.style.animationDelay = `${animationDelay}s`;
              
              // Card header with filename
              const cardHeader = document.createElement('div');
              cardHeader.className = 'data-card-header';
              
              const cardTitle = document.createElement('h4');
              cardTitle.className = 'data-card-title';
              cardTitle.textContent = item;
              cardHeader.appendChild(cardTitle);
              
              // Card actions
              const cardActions = document.createElement('div');
              cardActions.className = 'data-card-actions';
              
              // Clone the buttons for mobile
              const mobileRestoreBtn = document.createElement('button');
              mobileRestoreBtn.className = 'btn btn-sm';
              mobileRestoreBtn.textContent = 'æ¢å¤';
              mobileRestoreBtn.onclick = function() {
                if (confirm(`ç¡®è®¤æ¢å¤ "${item}" çš„ç‰ˆæœ¬å—ï¼Ÿ`)) {
                  restoreHistory(item);
                }
              };
              
              const mobileDeleteBtn = document.createElement('button');
              mobileDeleteBtn.className = 'btn btn-sm btn-danger';
              mobileDeleteBtn.textContent = 'åˆ é™¤';
              mobileDeleteBtn.onclick = function() {
                if (confirm(`ç¡®è®¤åˆ é™¤å†å²ç‰ˆæœ¬ "${item}" å—ï¼Ÿ`)) {
                  deleteHistory(item);
                }
              };
              
              cardActions.appendChild(mobileRestoreBtn);
              cardActions.appendChild(mobileDeleteBtn);
              
              card.appendChild(cardHeader);
              card.appendChild(cardActions);
              
              cardsContainer.appendChild(card);
              
              animationDelay += 0.05;
            });
            
            // Remove animation classes after animation completes
            setTimeout(() => {
              document.querySelectorAll('#history-table tbody tr, .data-card').forEach(el => {
                el.classList.remove('fade-in-up');
              });
            }, 1000);
          } else {
            showToast('åŠ è½½å†å²ç‰ˆæœ¬å¤±è´¥ï¼š' + data.error, 'error');
          }
        })
        .catch(err => {
          hideLoader();
          console.error("åŠ è½½å†å²ç‰ˆæœ¬é”™è¯¯:", err);
          showToast('åŠ è½½å†å²ç‰ˆæœ¬å‡ºé”™', 'error');
        });
      }
      
      function restoreHistory(fileName) {
        showLoader();
        
        fetch('restore_history.php', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({file: fileName})
        })
        .then(response => response.json())
        .then(data => {
          hideLoader();
          
          if (data.success) {
            showToast(`é…ç½®å·²æ¢å¤ä¸º "${fileName}"`);
            loadConfig();
            loadHistory();
            
            // Switch to config tab
            switchTab('config');
          } else {
            showToast('æ¢å¤å¤±è´¥ï¼š' + data.error, 'error');
          }
        })
        .catch(err => {
          hideLoader();
          console.error("æ¢å¤å†å²ç‰ˆæœ¬é”™è¯¯:", err);
          showToast('æ¢å¤å†å²ç‰ˆæœ¬å‡ºé”™', 'error');
        });
      }
      
      function deleteHistory(fileName) {
        showLoader();
        
        fetch('delete_history.php', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({file: fileName})
        })
        .then(response => response.json())
        .then(data => {
          hideLoader();
          
          if (data.success) {
            showToast('å†å²ç‰ˆæœ¬åˆ é™¤æˆåŠŸ');
            loadHistory();
          } else {
            showToast('åˆ é™¤å¤±è´¥ï¼š' + data.error, 'error');
          }
        })
        .catch(err => {
          hideLoader();
          console.error("åˆ é™¤å†å²ç‰ˆæœ¬é”™è¯¯:", err);
          showToast('åˆ é™¤å†å²ç‰ˆæœ¬å‡ºé”™', 'error');
        });
      }
      
      // Initialize theme
      initTheme();
      
      // Add event listeners
      document.getElementById('login-btn').addEventListener('click', login);
      
      // Login on Enter key
      document.getElementById('login-password').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') login();
      });
      
      // Theme toggle
      themeToggle.addEventListener('click', toggleTheme);
      
      // Tab switching
      mainTabs.forEach(tab => {
        tab.addEventListener('click', function() {
          const tabId = this.getAttribute('data-tab');
          switchTab(tabId);
        });
      });
      
      // Config actions
      document.getElementById('save-config-btn').addEventListener('click', saveConfig);
      document.getElementById('format-config-btn').addEventListener('click', formatConfig);
      document.getElementById('upload-config-btn').addEventListener('click', uploadConfig);
      document.getElementById('generate-raw-link-btn').addEventListener('click', generateRawLink);
      
      // Endpoint actions
      document.getElementById('refresh-endpoints-btn').addEventListener('click', loadEndpoints);
      document.getElementById('save-endpoint-btn').addEventListener('click', saveEndpoint);
      document.getElementById('clear-endpoint-btn').addEventListener('click', clearEndpointForm);
      
      // History actions
      document.getElementById('refresh-history-btn').addEventListener('click', loadHistory);
      
      // Fullscreen editor actions
      document.getElementById('config-fullscreen').addEventListener('click', () => enterFullscreenMode('config'));
      document.getElementById('endpoint-fullscreen').addEventListener('click', () => enterFullscreenMode('endpoint'));
      document.getElementById('exit-fullscreen-btn').addEventListener('click', exitFullscreenMode);
      document.getElementById('fullscreen-save-btn').addEventListener('click', saveConfig);
      document.getElementById('fullscreen-format-btn').addEventListener('click', formatConfig);
      
      // Mobile action bar
      document.getElementById('mobile-save-btn').addEventListener('click', saveConfig);
      document.getElementById('mobile-format-btn').addEventListener('click', formatConfig);
      document.getElementById('mobile-fullscreen-btn').addEventListener('click', () => enterFullscreenMode('config'));
      
      // Prevent accidental zooming on mobile
      document.addEventListener('dblclick', function(e) {
        e.preventDefault();
      }, { passive: false });
      
      // Handle window resize
      window.addEventListener('resize', function() {
        if (configEditor) configEditor.refresh();
        if (endpointEditor) endpointEditor.refresh();
        if (fullscreenEditor) fullscreenEditor.refresh();
        
        // Update mobile action bar visibility
        if (isMobile) {
          mobileActionBar.classList.toggle('active', document.getElementById('config-tab').classList.contains('active'));
        }
        
        // Toggle mobile/desktop views based on screen size
        const isMobileView = window.innerWidth <= 768;
        document.querySelectorAll('.mobile-hide').forEach(el => {
          el.style.display = isMobileView ? 'none' : 'block';
        });
        document.querySelectorAll('.mobile-show').forEach(el => {
          el.style.display = isMobileView ? 'block' : 'none';
        });
      });
    });
  </script>
</body>
</html>